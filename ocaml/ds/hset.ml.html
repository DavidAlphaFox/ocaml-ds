<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <title>
hset.ml</title>
  <meta name="GENERATOR" content="caml2html 1.4.3">
<style type="text/css">
code,pre { color:black;background-color:white }a.Cannot { color:black;text-decoration:none }.Cstring { color: #aa4444; }
.Craise { color: red; }
.Cconstructor { color: #0033cc; }
.Ccomment { color: #990000; }
.Cassert,
.Cinclude,
.Copen { color: #cc9900; }
.Cbar,
.Cdo,
.Cdone,
.Cdownto,
.Celse,
.Cfor,
.Cif,
.Clazy,
.Cmatch,
.Cnew,
.Cor,
.Cthen,
.Cto,
.Ctry,
.Cwhen,
.Cwhile,
.Cwith { color: #77aaaa; }
.Cbegin,
.Cend,
.Cobject,
.Csig,
.Cstruct { color: #990099; }
.Clinenum { color: black; background-color: silver; }
.Cbackground { background-color: white; }
.Cannot:hover { background-color: #b4eeb4; }
.Calphakeyword,
.Casr,
.Cland,
.Clor,
.Clsl,
.Clsr,
.Clxor,
.Cmod { color: #808080; }
.Cfalse,
.Cnonalphakeyword,
.Cquotation,
.Ctrue { }
.Cand,
.Cas,
.Cclass,
.Cconstraint,
.Cexception,
.Cexternal,
.Cfun,
.Cfunction,
.Cfunctor,
.Cin,
.Cinherit,
.Cinitializer,
.Clet,
.Cmethod,
.Cmodule,
.Cmutable,
.Cof,
.Cprivate,
.Crec,
.Ctype,
.Cval,
.Cvirtual { color: green; }
</style>
</head>
<body>

<pre><a name="hset.ml"></a><span class="Ccomment">(**************************************************************************)</span>
<span class="Ccomment">(*                                                                        *)</span>
<span class="Ccomment">(*  Copyright (C) Jean-Christophe Filliatre                               *)</span>
<span class="Ccomment">(*                                                                        *)</span>
<span class="Ccomment">(*  This software is free software; you can redistribute it and/or        *)</span>
<span class="Ccomment">(*  modify it under the terms of the GNU Library General Public           *)</span>
<span class="Ccomment">(*  License version 2.1, with the special exception on linking            *)</span>
<span class="Ccomment">(*  described in file LICENSE.                                            *)</span>
<span class="Ccomment">(*                                                                        *)</span>
<span class="Ccomment">(*  This software is distributed in the hope that it will be useful,      *)</span>
<span class="Ccomment">(*  but WITHOUT ANY WARRANTY; without even the implied warranty of        *)</span>
<span class="Ccomment">(*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.                  *)</span>
<span class="Ccomment">(*                                                                        *)</span>
<span class="Ccomment">(**************************************************************************)</span>

<span class="Ccomment">(*i $Id$ i*)</span>

<span class="Copen">open</span> <span class="Cconstructor">Hashcons</span>

<span class="Ccomment">(*s Sets of integers implemented as Patricia trees, following Chris</span>
<span class="Ccomment">    Okasaki and Andrew Gill's paper {\em Fast Mergeable Integer Maps}</span>
<span class="Ccomment">    ({\tt\small http://www.cs.columbia.edu/\~{}cdo/papers.html\#ml98maps}).</span>
<span class="Ccomment">    Patricia trees provide faster operations than standard library's</span>
<span class="Ccomment">    module [Set], and especially very fast [union], [subset], [inter]</span>
<span class="Ccomment">    and [diff] operations. *)</span>

<span class="Ccomment">(*s The idea behind Patricia trees is to build a {\em trie} on the</span>
<span class="Ccomment">    binary digits of the elements, and to compact the representation</span>
<span class="Ccomment">    by branching only one the relevant bits (i.e. the ones for which</span>
<span class="Ccomment">    there is at least on element in each subtree). We implement here</span>
<span class="Ccomment">    {\em little-endian} Patricia trees: bits are processed from</span>
<span class="Ccomment">    least-significant to most-significant. The trie is implemented by</span>
<span class="Ccomment">    the following type [t]. [Empty] stands for the empty trie, and</span>
<span class="Ccomment">    [Leaf k] for the singleton [k]. (Note that [k] is the actual</span>
<span class="Ccomment">    element.) [Branch (m,p,l,r)] represents a branching, where [p] is</span>
<span class="Ccomment">    the prefix (from the root of the trie) and [m] is the branching</span>
<span class="Ccomment">    bit (a power of 2). [l] and [r] contain the subsets for which the</span>
<span class="Ccomment">    branching bit is respectively 0 and 1. Invariant: the trees [l]</span>
<span class="Ccomment">    and [r] are not empty. *)</span>

<span class="Ccomment">(*i*)</span>
<span class="Ctype">type</span> 'a elt <span class="Cnonalphakeyword">=</span> 'a hash_consed
<span class="Ccomment">(*i*)</span>

<span class="Ctype">type</span> 'a t <span class="Cnonalphakeyword">=</span>
  <span class="Cbar">|</span> <span class="Cconstructor">Empty</span>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <span class="Cof">of</span> 'a hash_consed
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cof">of</span> int <span class="Cnonalphakeyword">*</span> int <span class="Cnonalphakeyword">*</span> 'a t <span class="Cnonalphakeyword">*</span> 'a t

<span class="Ccomment">(*s Example: the representation of the set $\{1,4,5\}$ is</span>
<span class="Ccomment">    $$\mathtt{Branch~(0,~1,~Leaf~4,~Branch~(1,~4,~Leaf~1,~Leaf~5))}$$</span>
<span class="Ccomment">    The first branching bit is the bit 0 (and the corresponding prefix</span>
<span class="Ccomment">    is [0b0], not of use here), with $\{4\}$ on the left and $\{1,5\}$ on the</span>
<span class="Ccomment">    right. Then the right subtree branches on bit 2 (and so has a branching</span>
<span class="Ccomment">    value of $2^2 = 4$), with prefix [0b01 = 1]. *)</span>

<span class="Ccomment">(*s Empty set and singletons. *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">empty</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; bool">is_empty</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Ctrue">true</span></a> <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t">singleton</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">=</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>

<span class="Ccomment">(*s Testing the occurrence of a value is similar to the search in a</span>
<span class="Ccomment">    binary search tree, where the branching bit is used to select the</span>
<span class="Ccomment">    appropriate subtree. *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cnonalphakeyword">=</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int"><span class="Cland">land</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">)</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">0</a>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">j</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">j</a><span class="Cnonalphakeyword">.</span>tag
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">(</span><span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r</a><span class="Cnonalphakeyword">)</span>

<span class="Ccomment">(*s The following operation [join] will be used in both insertion and</span>
<span class="Ccomment">    union. Given two non-empty trees [t0] and [t1] with longest common</span>
<span class="Ccomment">    prefixes [p0] and [p1] respectively, which are supposed to</span>
<span class="Ccomment">    disagree, it creates the union of [t0] and [t1]. For this, it</span>
<span class="Ccomment">    computes the first bit [m] where [p0] and [p1] disagree and create</span>
<span class="Ccomment">    a branching node on that bit. Depending on the value of that bit</span>
<span class="Ccomment">    in [p0], [t0] will be the left subtree and [t1] the right one, or</span>
<span class="Ccomment">    the converse. Computing the first branching bit of [p0] and [p1]</span>
<span class="Ccomment">    uses a nice property of twos-complement representation of integers. *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int">lowest_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">x</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">x</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int"><span class="Cland">land</span></a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int"><span class="Cnonalphakeyword">-</span></a><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">x</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int">branching_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int">lowest_bit</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int"><span class="Clxor">lxor</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int">mask</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int"><span class="Cland">land</span></a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int">-1</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * 'a t * int * 'a t -&gt; 'a t">join</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">=</span>
  <span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int">branching_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <span class="Cin">in</span>
  <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
    <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int">mask</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span>
  <span class="Celse">else</span>
    <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int">mask</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">)</span>

<span class="Ccomment">(*s Then the insertion of value [k] in set [t] is easily implemented</span>
<span class="Ccomment">    using [join].  Insertion in a singleton is just the identity or a</span>
<span class="Ccomment">    call to [join], depending on the value of [k].  When inserting in</span>
<span class="Ccomment">    a branching tree, we first check if the value to insert [k]</span>
<span class="Ccomment">    matches the prefix [p]: if not, [join] will take care of creating</span>
<span class="Ccomment">    the above branching; if so, we just insert [k] in the appropriate</span>
<span class="Ccomment">    subtree, depending of the branching bit. *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cnonalphakeyword">=</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int">mask</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">)</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; 'a t">add</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a> <span class="Cnonalphakeyword">=</span>
  <span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t">ins</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
    <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>
    <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">j</a> <span class="Cas">as</span> t <span class="Cnonalphakeyword">-&gt;</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">j</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * 'a t * int * 'a t -&gt; 'a t">join</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag<span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">j</a><span class="Cnonalphakeyword">.</span>tag<span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span>
    <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cas">as</span> t <span class="Cnonalphakeyword">-&gt;</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
          <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
            <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t">ins</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span>
          <span class="Celse">else</span>
            <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t">ins</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span>
        <span class="Celse">else</span>
          <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * 'a t * int * 'a t -&gt; 'a t">join</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag<span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span>
  <span class="Cin">in</span>
  <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t">ins</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>

<span class="Ccomment">(*s The code to remove an element is basically similar to the code of</span>
<span class="Ccomment">    insertion. But since we have to maintain the invariant that both</span>
<span class="Ccomment">    subtrees of a [Branch] node are non-empty, we use here the</span>
<span class="Ccomment">    ``smart constructor'' [branch] instead of [Branch]. *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * int * 'a t * 'a t -&gt; 'a t">branch</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>
  <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>
  <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span>   <span class="Cnonalphakeyword">-&gt;</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b t -&gt; 'b t">remove</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">t</a> <span class="Cnonalphakeyword">=</span>
  <span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t -&gt; 'c t">rmv</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
    <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t"><span class="Cconstructor">Empty</span></a>
    <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c Hashcons.hash_consed">j</a> <span class="Cas">as</span> t <span class="Cnonalphakeyword">-&gt;</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c Hashcons.hash_consed">j</a><span class="Cnonalphakeyword">.</span>tag <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t"><span class="Cconstructor">Empty</span></a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t</a>
    <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cas">as</span> t <span class="Cnonalphakeyword">-&gt;</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
          <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">.</span>tag <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
            <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * int * 'c t * 'c t -&gt; 'c t">branch</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t -&gt; 'c t">rmv</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t1</a><span class="Cnonalphakeyword">)</span>
          <span class="Celse">else</span>
            <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * int * 'c t * 'c t -&gt; 'c t">branch</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t -&gt; 'c t">rmv</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t1</a><span class="Cnonalphakeyword">)</span>
        <span class="Celse">else</span>
          <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'c t">t</a>
  <span class="Cin">in</span>
  <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t -&gt; 'b t">rmv</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">t</a>

<span class="Ccomment">(*s One nice property of Patricia trees is to support a fast union</span>
<span class="Ccomment">    operation (and also fast subset, difference and intersection</span>
<span class="Ccomment">    operations). When merging two branching trees we examine the</span>
<span class="Ccomment">    following four cases: (1) the trees have exactly the same</span>
<span class="Ccomment">    prefix; (2/3) one prefix contains the other one; and (4) the</span>
<span class="Ccomment">    prefixes disagree. In cases (1), (2) and (3) the recursion is</span>
<span class="Ccomment">    immediate; in case (4) the function [join] creates the appropriate</span>
<span class="Ccomment">    branching.</span>
<span class="Ccomment"></span>
<span class="Ccomment">    When comparing branching bits, one has to be careful with the</span>
<span class="Ccomment">    leftmost bit (which is negative), so we introduce function</span>
<span class="Ccomment">    [unsigned_lt] below. *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">&gt;=</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool"><span class="Cnonalphakeyword">&lt;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool">||</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool"><span class="Cnonalphakeyword">&lt;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>  <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>  <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; 'a t">add</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; 'a t">add</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a>
  <span class="Cbar">|</span> <span class="Cnonalphakeyword">(</span><span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">)</span> <span class="Cas">as</span> s<span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <span class="Cnonalphakeyword">(</span><span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cas">as</span> t<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
      <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
        <span class="Ccomment">(* The trees have the same prefix. Merge the subtrees. *)</span>
        <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
        <span class="Ccomment">(* [q] contains [p]. Merge [t] with a subtree of [s]. *)</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <span class="Cthen">then</span>
          <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">)</span>
        <span class="Celse">else</span>
          <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <span class="Cthen">then</span>
        <span class="Ccomment">(* [p] contains [q]. Merge [s] with a subtree of [t]. *)</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a> <span class="Cthen">then</span>
          <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span>
        <span class="Celse">else</span>
          <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">n</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span>
        <span class="Ccomment">(* The prefixes disagree. *)</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * 'a t * int * 'a t -&gt; 'a t">join</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">q</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t -&gt; 'a t">union</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span>

<span class="Ccomment">(*s When checking if [s1] is a subset of [s2] only two of the above</span>
<span class="Ccomment">    four cases are relevant: when the prefixes are the same and when the</span>
<span class="Ccomment">    prefix of [s1] contains the one of [s2], and then the recursion is</span>
<span class="Ccomment">    obvious. In the other two cases, the result is [false]. *)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">subset</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a> <span class="Cnonalphakeyword">=</span> <span class="Cmatch">match</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a><span class="Cnonalphakeyword">)</span> <span class="Cwith">with</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Ctrue">true</span></a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
      <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">subset</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">subset</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span>
          <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">subset</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">subset</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a>
        <span class="Celse">else</span>
          <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">subset</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">subset</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a>
      <span class="Celse">else</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>

<span class="Ccomment">(*s To compute the intersection and the difference of two sets, we</span>
<span class="Ccomment">    still examine the same four cases as in [merge]. The recursion is</span>
<span class="Ccomment">    then obvious. *)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t -&gt; 'a t">inter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s2</a> <span class="Cnonalphakeyword">=</span> <span class="Cmatch">match</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s2</a><span class="Cnonalphakeyword">)</span> <span class="Cwith">with</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s2</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k2</a> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s2</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r2</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
      <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t -&gt; 'a t">inter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l2</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t -&gt; 'a t">inter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r2</a><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t -&gt; 'a t">inter</a> <span class="Cnonalphakeyword">(</span><span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a><span class="Cnonalphakeyword">)</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s2</a>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a t -&gt; 'a t">inter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <span class="Cnonalphakeyword">(</span><span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l2</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r2</a><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; 'a t">diff</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a> <span class="Cnonalphakeyword">=</span> <span class="Cmatch">match</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a><span class="Cnonalphakeyword">)</span> <span class="Cwith">with</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">k2</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed -&gt; 'a t -&gt; 'a t">remove</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">k2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
      <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; 'a t">diff</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; 'a t">diff</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <span class="Cthen">then</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <span class="Cthen">then</span>
          <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; 'a t">diff</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a><span class="Cnonalphakeyword">)</span>
        <span class="Celse">else</span>
          <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t">merge</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; 'a t">diff</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span>
        <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; 'a t">diff</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; 'a t">diff</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a>
      <span class="Celse">else</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a>

<span class="Ccomment">(*s All the following operations ([cardinal], [iter], [fold], [for_all],</span>
<span class="Ccomment">    [exists], [filter], [partition], [choose], [elements]) are</span>
<span class="Ccomment">    implemented as for any other kind of binary trees. *)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; int">cardinal</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">0</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">1</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; int">cardinal</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int"><span class="Cnonalphakeyword">+</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; int">cardinal</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; unit) -&gt; 'a t -&gt; unit">iter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; unit">f</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="unit"><span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">)</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; unit">f</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; unit) -&gt; 'a t -&gt; unit">iter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; unit">f</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; unit) -&gt; 'a t -&gt; unit">iter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; unit">f</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; 'b -&gt; 'b) -&gt; 'a t -&gt; 'b -&gt; 'b">fold</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b -&gt; 'b">f</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b">accu</a> <span class="Cnonalphakeyword">=</span> <span class="Cmatch">match</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a> <span class="Cwith">with</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b">accu</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b -&gt; 'b">f</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b">accu</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; 'b -&gt; 'b) -&gt; 'a t -&gt; 'b -&gt; 'b">fold</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b -&gt; 'b">f</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; 'b -&gt; 'b) -&gt; 'a t -&gt; 'b -&gt; 'b">fold</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b -&gt; 'b">f</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b">accu</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; bool">for_all</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Ctrue">true</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; bool">for_all</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; bool">for_all</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; bool">exists</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; bool">exists</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool">||</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; bool">exists</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; 'a t">filter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">pr</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cas">as</span> t <span class="Cnonalphakeyword">-&gt;</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">pr</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int * int * 'a t * 'a t -&gt; 'a t">branch</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; 'a t">filter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">pr</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; 'a t">filter</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">pr</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; bool) -&gt; 'a t -&gt; 'a t * 'a t">partition</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a> <span class="Cnonalphakeyword">=</span>
  <span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t -&gt; 'a t * 'a t">part</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">f</a> <span class="Cas">as</span> acc<span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
    <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t">acc</a>
    <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; bool">p</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cthen">then</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; 'a t">add</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">f</a><span class="Cnonalphakeyword">)</span> <span class="Celse">else</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; 'a t">add</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">f</a><span class="Cnonalphakeyword">)</span>
    <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t -&gt; 'a t * 'a t">part</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t -&gt; 'a t * 'a t">part</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t">acc</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">)</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t1</a>
  <span class="Cin">in</span>
  <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t * 'a t -&gt; 'a t -&gt; 'a t * 'a t">part</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">)</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">choose</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="exn -&gt; 'a Hashcons.hash_consed">raise</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="exn"><span class="Cconstructor">Not_found</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">choose</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t0</a>   <span class="Ccomment">(* we know that [t0] is non-empty *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed list">elements</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a> <span class="Cnonalphakeyword">=</span>
  <span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed list -&gt; 'b t -&gt; 'b Hashcons.hash_consed list">elements_aux</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed list">acc</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
    <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed list">acc</a>
    <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">::</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed list">acc</a>
    <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed list -&gt; 'b t -&gt; 'b Hashcons.hash_consed list">elements_aux</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed list -&gt; 'b t -&gt; 'b Hashcons.hash_consed list">elements_aux</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed list">acc</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l</a><span class="Cnonalphakeyword">)</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r</a>
  <span class="Cin">in</span>
  <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed list -&gt; 'a t -&gt; 'a Hashcons.hash_consed list">elements_aux</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed list"><span class="Cnonalphakeyword">[</span><span class="Cnonalphakeyword">]</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a>

<span class="Ccomment">(*s There is no way to give an efficient implementation of [min_elt]</span>
<span class="Ccomment">    and [max_elt], as with binary search trees.  The following</span>
<span class="Ccomment">    implementation is a traversal of all elements, barely more</span>
<span class="Ccomment">    efficient than [fold min t (choose t)] (resp. [fold max t (choose</span>
<span class="Ccomment">    t)]). Note that we use the fact that there is no constructor</span>
<span class="Ccomment">    [Empty] under [Branch] and therefore always a minimal</span>
<span class="Ccomment">    (resp. maximal) element there. *)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">min_elt</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="exn -&gt; 'a Hashcons.hash_consed">raise</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="exn"><span class="Cconstructor">Not_found</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a Hashcons.hash_consed -&gt; 'a Hashcons.hash_consed">min</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">min_elt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">min_elt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">max_elt</a> <span class="Cnonalphakeyword">=</span> <span class="Cfunction">function</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="exn -&gt; 'a Hashcons.hash_consed">raise</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="exn"><span class="Cconstructor">Not_found</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a Hashcons.hash_consed -&gt; 'a Hashcons.hash_consed">max</a> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">max_elt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'a Hashcons.hash_consed">max_elt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">t</a><span class="Cnonalphakeyword">)</span>

<span class="Ccomment">(*s Another nice property of Patricia trees is to be independent of the</span>
<span class="Ccomment">    order of insertion. As a consequence, two Patricia trees have the</span>
<span class="Ccomment">    same elements if and only if they are structurally equal. *)</span>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a -&gt; 'a -&gt; bool">equal</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a -&gt; 'a -&gt; bool"><span class="Cnonalphakeyword">(</span><span class="Cnonalphakeyword">=</span><span class="Cnonalphakeyword">)</span></a>

<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a -&gt; 'a -&gt; int">compare</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a -&gt; 'a -&gt; int">compare</a>

<span class="Ccomment">(*i*)</span>
<span class="Clet">let</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed list -&gt; 'a t">make</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed list">l</a> <span class="Cnonalphakeyword">=</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="('a Hashcons.hash_consed -&gt; 'a t -&gt; 'a t) -&gt; 'a Hashcons.hash_consed list -&gt; 'a t -&gt; 'a t"><span class="Cconstructor">List</span><span class="Cnonalphakeyword">.</span>fold_right</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'a t -&gt; 'a t">add</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed list">l</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">empty</a>
<span class="Ccomment">(*i*)</span>

<span class="Ccomment">(*s Additional functions w.r.t to [Set.S]. *)</span>

<span class="Clet">let</span> <span class="Crec">rec</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">intersect</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a> <span class="Cnonalphakeyword">=</span> <span class="Cmatch">match</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a><span class="Cnonalphakeyword">)</span> <span class="Cwith">with</span>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cconstructor">Empty</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cconstructor">Empty</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>
  <span class="Cbar">|</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a><span class="Cnonalphakeyword">,</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t"><span class="Cnonalphakeyword">_</span></a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed -&gt; 'b t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a Hashcons.hash_consed">k1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a>
  <span class="Cbar">|</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t"><span class="Cnonalphakeyword">_</span></a><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Leaf</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">k2</a> <span class="Cnonalphakeyword">-&gt;</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed -&gt; 'a t -&gt; bool">mem</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b Hashcons.hash_consed">k2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a>
  <span class="Cbar">|</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a><span class="Cnonalphakeyword">)</span><span class="Cnonalphakeyword">,</span> <span class="Cconstructor">Branch</span> <span class="Cnonalphakeyword">(</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a><span class="Cnonalphakeyword">,</span><a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a><span class="Cnonalphakeyword">)</span> <span class="Cnonalphakeyword">-&gt;</span>
      <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">==</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">intersect</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool">||</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">intersect</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">intersect</a> <span class="Cnonalphakeyword">(</span><span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">l1</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">r1</a><span class="Cnonalphakeyword">)</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">s2</a>
      <span class="Celse">else</span> <span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">unsigned_lt</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool -&gt; bool -&gt; bool"><span class="Cnonalphakeyword">&amp;&amp;</span></a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; int -&gt; bool">match_prefix</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p2</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t -&gt; 'b t -&gt; bool">intersect</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'a t">s1</a> <span class="Cnonalphakeyword">(</span><span class="Cif">if</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int -&gt; int -&gt; bool">zero_bit</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">p1</a> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="int">m2</a> <span class="Cthen">then</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">l2</a> <span class="Celse">else</span> <a href="javascript:;" style="text-decoration:none" class="Cannot" title="'b t">r2</a><span class="Cnonalphakeyword">)</span>
      <span class="Celse">else</span>
        <a href="javascript:;" style="text-decoration:none" class="Cannot" title="bool"><span class="Cfalse">false</span></a>
</pre>

<hr>
<p>
<em>This document was generated using 
<a href="http://martin.jambon.free.fr/caml2html.html">caml2html</a></em>
</body>
</html>
